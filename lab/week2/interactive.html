<!DOCTYPE HTML>
<html>

<style>
.center {
    margin: auto;
    padding: 10px;
}

.hidden {
    display: none;
}
</style>

<head>
<script type="text/javascript" src="canvasjs.min.js"></script>
<script type="text/javascript">
	
function onStart()
{
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() 
	{

		if (this.readyState == 4 && this.status == 200) 
	    {
		    document.getElementById("rawdata").value = new String(this.responseText);
		    var array = []
			var rawData = this.response;
			array = String(rawData.split("\n")).split(",");
			array = array.slice(0,-1);

			datesArray = []
			valuesArray = []

			for (var i = 0; i < (array.length/2); i++)
			{
				var dateString = String(array[i * 2]);
				var year = dateString.substring(0,4);
				var month = dateString.substring(4,6);
				var day = dateString.substring(6,8);
				var date = new Date(year, month-1, day);

				datesArray[i] = date.getTime();
				valuesArray[i] = Number(array[i * 2 + 1])
			}

				//console.log(valuesArray)

			var datesRange = [datesArray[0],datesArray[364]];
			var valuesRange = [Math.min.apply(null,valuesArray),Math.max.apply(null,valuesArray)];


			//console.log(valuesRange)
			//console.log(datesRange)
			imgWidthRange = [0,document.getElementById('graph').offsetWidth];
			imgHeightRange = [0,document.getElementById('graph').offsetHeight];

			console.log(imgHeightRange)
			console.log(imgWidthRange)

			function createTransform(domain, range)
			{
			    var domain_min = domain[0]
			    var domain_max = domain[1]
			    var range_min = range[0]
			    var range_max = range[1]

			    // formulas to calculate the alpha and the beta
			   	var alpha = (range_max - range_min) / (domain_max - domain_min)
			    var beta = range_max - alpha * domain_max
			    // returns the function for the linear transformation (y= a * x + b)
			    return function(x)
			    {
			      return alpha * x + beta;
			    }
			}

			valuesTransform = createTransform(valuesRange,imgHeightRange);
			//console.log(imgHeightRange)
			datesTransform = createTransform(datesRange,imgWidthRange);
			//console.log(imgWidthRange)
	
			months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
			dataPoints = []
			for (var i = 0; i < valuesArray.length; i++)
			{
				dataPoints.push
				({
					x: new Date(datesArray[i]),
					//x: datesTransform(datesArray[i]),
					y: valuesTransform(valuesArray[i]),
					label: String(new Date(datesArray[i])).replace(/(([^\s]+\s\s*){4})(.*)/,"$1"),
					y: valuesArray[i]
				});	
			}
				
			var data = []; 
			var dataSeries = { type: "line" };

			dataSeries.dataPoints = dataPoints;
			data.push(dataSeries); 

			var chart = new CanvasJS.Chart("graph",
			{
				zoomEnabled: true,
				animationEnabled: true,
				title:
				{
				text: "De Bilt average temperatures" 
				},
				axisX:{  
				interval: 1,
				labelFontSize: 13,
				intervalType: "month",
				labelAngle: -50,
				labelFontColor: "rgb(0,75,141)"
			},

				axisY :
				{
				includeZero:false,
				title: "Temperature in .1 Celcius"
				},
				data: data  
			});
				
			chart.render();
	    };
	};
	xhttp.open("GET", "https://raw.githubusercontent.com/MinorJoost/DATAPROCESSING/master/lab/week2/data.csv", true);
	xhttp.send();
};
</script>
</head>

<body onload="setTimeout(onStart(),200)">
  <div id="graph" class="center" style="height: 500px; width: 85%;"></div>
  <textarea id="rawdata" class="hidden"></textarea>
</body>

</html>
